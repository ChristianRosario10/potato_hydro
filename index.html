<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potato Hydro Monitoring System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sensor-card {
            margin-bottom: 20px;
        }
        .reading-value {
            font-size: 24px;
            font-weight: bold;
        }
        .timestamp {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">Potato Hydro Monitor</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row" id="sensorReadings">
            <!-- Sensor readings will be dynamically inserted here -->
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <h3>Sensor History</h3>
                <div id="historyChart"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD51VjKsCK-HpeDno6cVqrbPBeshynIOic",
            authDomain: "potato-hydro.firebaseapp.com",
            databaseURL: "https://potato-hydro-default-rtdb.firebaseio.com",
            projectId: "potato-hydro",
            storageBucket: "potato-hydro.firebasestorage.app",
            messagingSenderId: "569203450870",
            appId: "1:569203450870:web:86b80d4d45843253d45dd7",
            measurementId: "G-TJ2L4QJS24"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Listen for real-time sensor data updates
        const sensorRef = database.ref('sensor_data');
        sensorRef.on('value', (snapshot) => {
            const data = snapshot.val();
            updateSensorDisplay(data);
        });

        function updateSensorDisplay(data) {
            const container = document.getElementById('sensorReadings');
            container.innerHTML = ''; // Clear existing content

            for (const [sensor, value] of Object.entries(data)) {
                const card = `
                    <div class="col-md-4">
                        <div class="card sensor-card">
                            <div class="card-body">
                                <h5 class="card-title">${sensor.replace('_', ' ').toUpperCase()}</h5>
                                <p class="reading-value">${value}</p>
                                <p class="timestamp">Last updated: ${new Date().toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            }
        }

        // Load historical data
        const historyRef = database.ref('sensor_history').orderByChild('timestamp').limitToLast(100);
        historyRef.on('value', (snapshot) => {
            const historyData = snapshot.val();
            if (historyData) {
                updateHistoryChart(historyData);
            }
        });

        let historyChart;
        function updateHistoryChart(data) {
            const timestamps = [];
            const values = {};

            Object.values(data).forEach(reading => {
                timestamps.push(new Date(reading.timestamp).toLocaleTimeString());
                for (const [sensor, value] of Object.entries(reading)) {
                    if (sensor !== 'timestamp') {
                        if (!values[sensor]) values[sensor] = [];
                        values[sensor].push(value);
                    }
                }
            });

            const ctx = document.getElementById('historyChart');
            if (historyChart) {
                historyChart.destroy();
            }

            historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timestamps,
                    datasets: Object.entries(values).map(([sensor, data]) => ({
                        label: sensor,
                        data: data,
                        borderColor: getRandomColor(),
                        fill: false
                    }))
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        }
                    }
                }
            });
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    </script>
</body>
</html> 